<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
    <script type="text/javascript" src="epos-2.9.0.js"></script>
  </head>
  <body>
    <button type="button" name="button" onclick="test()">test</button>
    <script>
        function test () {
          let builder = new epson.ePOSBuilder()
          console.log(builder);
          // get current date
          let now = new Date();
          // builder.addPageBegin()
          // builder.addPageArea(0, 0, 384, 300);
          builder.addTextLang('en')
          builder.addTextSmooth(true);
          builder.addTextFont(builder.FONT_A);
          builder.addTextSize(1, 1);
          builder.addTextStyle(false, false, true)
          builder.addTextAlign(builder.ALIGN_CENTER)
          builder.addText('Tk & Sdk Sang Timur Tomang\n');
          builder.addText('Telp. 021-72839483\n');
          builder.addTextSize(1, 1);
          builder.addTextFont(builder.FONT_SPECIAL_B);
          builder.addText('Jl. Taman Kedoya Permai, Kebayoran Baru, Jakarta Selatan, 12345');
          // format - line
          builder.addTextStyle(0, 0, 0);
          // builder.addPagePosition(0, 110);

          builder.addTextFont(builder.FONT_SPECIAL_B);
          builder.addText('\n12345 - ' + now.toDateString() + ' ' + now.toTimeString().slice(0, 8) + ' Kasir: Kevin Himawan\n');
          builder.addTextStyle(0, 0, 0);
          // builder.addPagePosition(1, 170);
          builder.addText('\n');
          builder.addTextStyle(0, 0, 0);

          // header struk
          let headerKey = ['Nama Produk', 'Size', 'Jumlah', 'Harga', 'Total']
          let pos = 0
          for (let i = 0; i < headerKey.length; i++) {

            builder.addTextPosition(pos, 190)
            builder.addText(headerKey[i])
            builder.addTextStyle(0, 0, 0);
            if (i === 0) {
              pos += 260
            } else if (i === 1) {
              pos += 50
            } else if (i === 2) {
              pos += 80
            } else {
              pos += 100
            }
          }

          // page break
          builder.addText('\n');
          let sampleText = [{
            name: 'Bulpen faster 2.0',
            size: 'XL',
            jumlah: 20,
            price: 2000,
            totalPrice: 40000
          },{
            name: 'Bulpen faster 2.0',
            size: 'XL',
            jumlah: 20,
            price: 2000,
            totalPrice: 40000
          },{
            name: 'Bulpen faster 2.0',
            size: 'XL',
            jumlah: 20,
            price: 2000,
            totalPrice: 40000
          },{
            name: 'Bulpen faster 2.0',
            size: 'XL',
            jumlah: 20,
            price: 2000,
            totalPrice: 40000
          },{
            name: 'Bulpen faster 2.0',
            size: 'XL',
            jumlah: 20,
            price: 2000,
            totalPrice: 40000
          },{
            name: 'Bulpen faster 2.0',
            size: 'XL',
            jumlah: 20,
            price: 2000,
            totalPrice: 40000
          },{
            name: 'Bulpen faster 2.0',
            size: 'XL',
            jumlah: 1,
            price: 2000,
            totalPrice: 2000
          },{
            name: 'Bulpen faster 2.0',
            size: 'XL',
            jumlah: 6,
            price: 2000,
            totalPrice: 12000
          },{
            name: 'Bulpen faster 2.0',
            size: 'XL',
            jumlah: 2,
            price: 100,
            totalPrice: 200
          },{
            name: 'Bulpen faster 2.0',
            size: 'XL',
            jumlah: 20,
            price: 2000,
            totalPrice: 40000
          },{
            name: 'Bulpen faster Bulpen',
            size: 'XL',
            jumlah: 20,
            price: 2000,
            totalPrice: 400
          },{
            name: 'Bulpen faster 2.0',
            size: 'XL',
            jumlah: 20,
            price: 2000,
            totalPrice: 400000
          }]

          // Produk struk
          for (let i = 0; i < sampleText.length; i++) {
            let pos = 0
            let value = Object.values(sampleText[i])
            Object.keys(sampleText[i]).map((key, idx) => {
              builder.addTextAlign(builder.ALIGN_LEFT)
              builder.addTextPosition(pos, 0)
              builder.addTextAlign(builder.ALIGN_LEFT)
              builder.addText(`${value[idx]}`)
              builder.addTextStyle(0, 0, 0);
              if (idx === 0) {
                pos += 260
              } else if (idx === 1) {
                pos += 50
              } else if (idx === 2) {
                pos += 80
              } else {
                pos += 100
              }
            })
            builder.addText('\n');
          }
          builder.addText('\n');

          // price section
          let priceSection = [{
            'Sub Total': 12000,
            Pajak: 10,
            'Potongan Harga Total': 0,
            'Grand Total': 13200,
            'Total Bayar': 15000,
            'Total Kembalian': 1800
          }]
          for (let i = 0; i < priceSection.length; i++) {
            let value = Object.values(priceSection[i])
            Object.keys(priceSection[i]).map((key, idx) => {
              // builder.addTextAlign(builder.ALIGN_RIGHT)
              builder.addTextPosition(210, 10)
              builder.addTextAlign(builder.ALIGN_LEFT)
              builder.addText(key)
              builder.addTextStyle(0, 0, 0);
              builder.addTextPosition(510, 0)
              builder.addTextAlign(builder.ALIGN_RIGHT)
              builder.addText(value[idx])
              builder.addTextStyle(0, 0, 0);
              builder.addText('\n');
            })
          }
          builder.addText('\n');
          // footer
          let footerSection = [{
            'Tipe Pembayaran': "DEBIT",
            'Nomor Kartu': "129391293299000"
          }]

          for (let i = 0; i < footerSection.length; i++) {
            let value = Object.values(footerSection[i])
            Object.keys(footerSection[i]).map((key, idx) => {
              builder.addTextAlign(builder.ALIGN_LEFT)
              builder.addText(key)
              builder.addTextPosition(230, 0)
              builder.addText(value[idx])
              builder.addTextStyle(0, 0, 0);
              builder.addText('\n');
            })
          }

          builder.addText('\n');
          builder.addText('\n');
          builder.addTextFont(builder.FONT_SPECIAL_B);
          builder.addText('Barang yang sudah dibeli tidak dapat di kembalikan ataupun ditukarkan.\n')
          builder.addText('\n');
          builder.addTextStyle(false, false, true)
          builder.addTextAlign(builder.ALIGN_CENTER)
          builder.addText('Powered By Uniform.id\n')

          builder.addCut(builder.CUT_FEED); //Acquire the print document
          let request = builder.toString();
          let address = 'http://192.168.192.168/cgi-bin/epos/service.cgi?devid=local_printer&timeout=10000'

          let epos = new epson.ePOSPrint(address)
          console.log(epos)
          epos.send(request)
        }
    </script>
  </body>
</html>
