<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
    <script type="text/javascript" src="epos-2.9.0.js"></script>
  </head>
  <body>
    <button type="button" name="button" onclick="test()">test</button>
    <script>
        function test () {
          let builder = new epson.ePOSBuilder()
          console.log(builder);
          // get current date
          let now = new Date();
          builder.addPageBegin()
          // builder.addPageArea(0, 0, 384, 100);
          builder.addTextLang('en')
          builder.addTextSmooth(true);
          builder.addTextFont(builder.FONT_A);
          builder.addTextSize(1, 1);
          builder.addTextStyle(false, false, true)
          builder.addTextAlign(builder.ALIGN_CENTER)
          builder.addText('Tk & Sdk Sang Timur Tomang\n');
          builder.addText('Telp. 021-72839483\n');
          builder.addTextSize(1, 1);
          builder.addTextFont(builder.FONT_SPECIAL_B);
          builder.addText('Jl. Taman Kedoya Permai, Kebayoran Baru, Jakarta Selatan, 12345');
          // format - line
          builder.addTextStyle(0, 1, 0);
          builder.addPagePosition(0, 110);

          builder.addTextFont(builder.FONT_SPECIAL_B);
          builder.addText('\n12345 - ' + now.toDateString() + ' ' + now.toTimeString().slice(0, 8) + ' Kasir: Kevin Himawan\n');
          builder.addTextStyle(0, 1, 0);
          builder.addPagePosition(1, 170);
          builder.addText('\n');
          builder.addTextStyle(0, 0, 0);

          // header struk
          let headerKey = ['Nama Produk', 'Size', 'Jumlah', 'Harga', 'Total']
          let pos = 0
          for (let i = 0; i < headerKey.length; i++) {
            builder.addTextPosition(pos, 190)
            builder.addText(headerKey[i])
            builder.addTextStyle(0, 0, 0);
            pos+=100
          }

          // page break
          builder.addText('\n');
          let sampleText = [{
            name: 'Bulpen faster 2.0',
            size: 'XL',
            jumlah: 20,
            price: 2000,
            totalPrice: 0
          }]

          // Produk struk
          for (let i = 0; i < sampleText.length; i++) {
            let pos = 0
            let value = Object.values(sampleText[i])
            Object.keys(sampleText[i]).map((key, idx) => {
              builder.addTextPosition(pos, 0)
              builder.addText(`${value[idx]}`)
              builder.addTextStyle(0, 0, 0);
              pos+=100
              builder.addText('\n');
            })
            builder.addText('\n');
          }

          // price section
          let priceSection = [{
            subtotal: 12000,
            pajak: 10,
            potongan_harga_total: 0,
            grand_total: 13200,
            total_bayar: 15000,
            total_kembalian: 1800
          }]
          for (let i = 0; i < priceSection.length; i++) {
            let pos = 0
            let value = Object.values(priceSection[i])
            Object.keys(priceSection[i]).map((key, idx) => {
              builder.addTextAlign(builder.ALIGN_RIGHT)
              builder.addText(key)
              builder.addTextPosition(250, 0)
              builder.addText(value[idx])
              builder.addTextStyle(0, 1, 0);
              builder.addText('\n');
            })
          }

          // footer
          let footerSection = [{
            tipe_pembayaran: "DEBIT",
            nomor_kartu: "129391293299000"
          }]

          for (let i = 0; i < priceSection.length; i++) {
            let pos = 0
            let value = Object.values(priceSection[i])
            Object.keys(priceSection[i]).map((key, idx) => {
              builder.addText(key)
              builder.addTextPosition(250, 0)
              builder.addText(value[idx])
              builder.addTextStyle(0, 1, 0);
              builder.addText('\n');
            })
          }

          builder.addText('\n');

          builder.addTextFont(builder.FONT_SPECIAL_B);
          builder.addText('Barang yang sudah dibeli tidak dapat di kembalikan ataupun ditukarkan.\n')


          builder.addText('\n')
          builder.addText('\n')
          builder.addText('Powered By Uniform.id')

          // end page mode
          builder.addPageEnd();
          // builder.addPageLine(100, 100, 0, 0, builder.LINE_THIN)
          // builder.addFeedLine(30) //ini panjang struk
          builder.addCut(builder.CUT_FEED); //Acquire the print document
          let request = builder.toString();
          let address = 'http://192.168.192.168/cgi-bin/epos/service.cgi?devid=local_printer&timeout=10000'

          let epos = new epson.ePOSPrint(address)
          console.log(epos)
          epos.send(request)
        }
    </script>
  </body>
</html>
